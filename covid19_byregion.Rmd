---
title: "Coronavirus per gruppi di regione"
author: "Alessio Passalacqua"
date: "`r Sys.Date()`"
output: 
  html_document:
    theme: cosmo
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
```

```{r}
library(dplyr)
library(lubridate)
library(ggplot2)
library(magrittr)
theme_set(theme_bw())
```


```{r}
covid_italy <- read.csv("https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv")
```


```{r}
covid_italy %>%
  glimpse()
```


```{r}
covid_italy %<>%
   mutate(data = date(data)) %>%
   mutate(regione = as.character(denominazione_regione)) %>%
   select(-denominazione_regione,
          -stato,
          -codice_regione,
          -lat,
          -long) %>%
  mutate(regione = ifelse(.$regione == "Trento","Trentino-Alto Adige",.$regione))%>%
  mutate( regione = ifelse(.$regione == "Bolzano","Trentino-Alto Adige",.$regione)) %>%
  mutate(regione = ifelse(.$regione == "P.A. Trento","Trentino-Alto Adige",.$regione))%>%
  mutate( regione = ifelse(.$regione == "P.A. Bolzano","Trentino-Alto Adige",.$regione)) %>%
  group_by(regione,data) %>%
  summarize_all(~sum(.)) %>%
  ungroup(regione) %>%
  arrange(desc(data),desc(totale_casi)) 
```

```{r,eval=F}
covid_italy
```

```{r}
covid_nord_ovest <- 
  covid_italy %>%
  filter(regione %in% 
           c("Piemonte", "Valle d'Aosta", "Liguria", "Lombardia")) %>%
  select(-regione) %>%
 group_by(data) %>%
  summarise(totale_nord_ovest = sum(totale_casi)) %>%
  mutate(nuovi_casi_no = totale_nord_ovest - lag(totale_nord_ovest)) 
  
covid_nord_ovest %>%
  ggplot(aes(data,nuovi_casi_no)) + geom_line()
```


```{r}
covid_nord_est <- 
  covid_italy %>%
  filter(regione %in% 
           c("Trentino-Alto Adige", "Veneto", "Friuli Venezia Giulia", "Emilia Romagna")) %>%
  select(-regione) %>%
 group_by(data) %>%
  summarise(totale_nord_est = sum(totale_casi)) %>%
  mutate(nuovi_casi_ne = totale_nord_est - lag(totale_nord_est)) 
  
covid_nord_est %>%
  ggplot(aes(data,nuovi_casi_ne)) + geom_line()
```

```{r}
covid_centro <- 
  covid_italy %>%
  filter(regione %in% 
           c("Toscana", "Umbria", "Marche", "Lazio")) %>%
  select(-regione) %>%
 group_by(data) %>%
  summarise(totale_centro = sum(totale_casi)) %>%
  mutate(nuovi_casi_ce = totale_centro - lag(totale_centro)) 
  
covid_centro %>%
  ggplot(aes(data,nuovi_casi_ce)) + geom_line()
```

```{r}
covid_sud_isole <- 
  covid_italy %>%
  filter(regione %in% 
           c("Abruzzo", "Molise", "Campania", "Puglia", 
             "Basilicata", "Calabria","Sicilia","Sardegna")) %>%
  select(-regione) %>%
 group_by(data) %>%
  summarise(totale_sud_isole = sum(totale_casi)) %>%
  mutate(nuovi_casi_si = totale_sud_isole - lag(totale_sud_isole)) 
  
covid_sud_isole %>%
  ggplot(aes(data,nuovi_casi_si)) + geom_line()
```



```{r}
covid_byregion <-
covid_nord_ovest %>%
  left_join(covid_nord_est) %>%
  left_join(covid_centro) %>%
  left_join(covid_sud_isole) %>%
  select(data,nuovi_casi_no,nuovi_casi_ne,nuovi_casi_si,nuovi_casi_ce)
```

```{r}
library(tidyr)
covid_byregion %>%
  gather(gr,nuovi_casi,-data)  %>%
  ggplot(aes(x=data,y=nuovi_casi,colour=gr)) + 
  geom_line(aes(colour=gr))  
  
```

