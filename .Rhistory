geom_line() +
geom_point(colour="blue",aes(y=xy$y)) +
geom_point(colour="red",aes(y=nomodel),shape=15,size=2) +
geom_line(aes(y = Lower), color = "red", linetype = "dashed")+
geom_line(aes(y = Upper), color = "red", linetype = "dashed")+
#-- ITALY
annotate(geom = "text", x = 5, y = 70000,
label = "Training data", hjust = 0) +
annotate("pointrange", x = 3.5, y = 70000, ymin = 69500,
ymax = 70500,colour = "blue", size = 0.7)+
#-- FIT
annotate(geom = "text", x = 5, y = 65000,
label = "Fit logistico", hjust = 0) +
annotate(geom = "segment", x = 2.5,xend = 4,
y = 65000,yend=65000) +
#-- CONF
annotate(geom = "text", x = 5, y = 60000,
label = "Intervallo di confidenza 95%", hjust = 0) +
annotate(geom = "segment", x = 2.5,xend = 3,
y = 60000,yend=60000, colour="red") +
annotate(geom = "segment", x = 3.5,xend = 4,
y = 60000,yend=60000, colour="red") +
#-- Test
annotate(geom = "text", x = 5, y = 55000,
label = "Test data", hjust = 0) +
annotate(geom="rect",xmin=3, xmax=3.5, ymin=55000 , ymax=56000, color="red", fill="red") +
geom_text( aes( x=3, y=50000, label="label"),                 ,
color="orange",
size=7 , angle=45, fontface="bold" )+
#-- #iorestoacasa
labs(title = "Crescita contagiati Coronavirus Italia ",
subtitle = "Previsione curva di crescita",
caption = "Dati: Protezione Civile \n
#iorestoacasa",
x = "Giorni",
y = "Totale Positivi")
ggplot(xy_fit,aes(x=1:50,y=Prediction))  +
geom_line() +
geom_point(colour="blue",aes(y=xy$y)) +
geom_point(colour="red",aes(y=nomodel),shape=15,size=2) +
geom_line(aes(y = Lower), color = "red", linetype = "dashed")+
geom_line(aes(y = Upper), color = "red", linetype = "dashed")+
#-- ITALY
annotate(geom = "text", x = 5, y = 70000,
label = "Training data", hjust = 0) +
annotate("pointrange", x = 3.5, y = 70000, ymin = 69500,
ymax = 70500,colour = "blue", size = 0.7)+
#-- FIT
annotate(geom = "text", x = 5, y = 65000,
label = "Fit logistico", hjust = 0) +
annotate(geom = "segment", x = 2.5,xend = 4,
y = 65000,yend=65000) +
#-- CONF
annotate(geom = "text", x = 5, y = 60000,
label = "Intervallo di confidenza 95%", hjust = 0) +
annotate(geom = "segment", x = 2.5,xend = 3,
y = 60000,yend=60000, colour="red") +
annotate(geom = "segment", x = 3.5,xend = 4,
y = 60000,yend=60000, colour="red") +
#-- Test
annotate(geom = "text", x = 5, y = 55000,
label = "Test data", hjust = 0) +
annotate(geom="rect",xmin=3, xmax=3.5, ymin=55000 , ymax=56000, color="red", fill="red") +
geom_text( aes( x=40, y=10000, label="#iorestoacasa"),                 ,
color="orange",
size=7 , fontface="bold" )+
#-- #iorestoacasa
labs(title = "Crescita contagiati Coronavirus Italia ",
subtitle = "Previsione curva di crescita",
caption = "Dati: Protezione Civile \n
#iorestoacasa",
x = "Giorni",
y = "Totale Positivi")
ggplot(xy_fit,aes(x=1:50,y=Prediction))  +
geom_line() +
geom_point(colour="blue",aes(y=xy$y)) +
geom_point(colour="red",aes(y=nomodel),shape=15,size=2) +
geom_line(aes(y = Lower), color = "red", linetype = "dashed")+
geom_line(aes(y = Upper), color = "red", linetype = "dashed")+
#-- ITALY
annotate(geom = "text", x = 5, y = 70000,
label = "Training data", hjust = 0) +
annotate("pointrange", x = 3.5, y = 70000, ymin = 69500,
ymax = 70500,colour = "blue", size = 0.7)+
#-- FIT
annotate(geom = "text", x = 5, y = 65000,
label = "Fit logistico", hjust = 0) +
annotate(geom = "segment", x = 2.5,xend = 4,
y = 65000,yend=65000) +
#-- CONF
annotate(geom = "text", x = 5, y = 60000,
label = "Intervallo di confidenza 95%", hjust = 0) +
annotate(geom = "segment", x = 2.5,xend = 3,
y = 60000,yend=60000, colour="red") +
annotate(geom = "segment", x = 3.5,xend = 4,
y = 60000,yend=60000, colour="red") +
#-- Test
annotate(geom = "text", x = 5, y = 55000,
label = "Test data", hjust = 0) +
annotate(geom="rect",xmin=3, xmax=3.5, ymin=55000 , ymax=56000, color="red", fill="red") +
geom_label( aes( x=40, y=10000, label="#iorestoacasa"),                 ,
color="orange",
size=7 , fontface="bold" )+
#-- #iorestoacasa
labs(title = "Crescita contagiati Coronavirus Italia ",
subtitle = "Previsione curva di crescita",
caption = "Dati: Protezione Civile \n
#iorestoacasa",
x = "Giorni",
y = "Totale Positivi")
ggplot(xy_fit,aes(x=1:50,y=Prediction))  +
geom_line() +
geom_point(colour="blue",aes(y=xy$y)) +
geom_point(colour="red",aes(y=nomodel),shape=15,size=2) +
geom_line(aes(y = Lower), color = "red", linetype = "dashed")+
geom_line(aes(y = Upper), color = "red", linetype = "dashed")+
#-- ITALY
annotate(geom = "text", x = 5, y = 70000,
label = "Training data", hjust = 0) +
annotate("pointrange", x = 3.5, y = 70000, ymin = 69500,
ymax = 70500,colour = "blue", size = 0.7)+
#-- FIT
annotate(geom = "text", x = 5, y = 65000,
label = "Fit logistico", hjust = 0) +
annotate(geom = "segment", x = 2.5,xend = 4,
y = 65000,yend=65000) +
#-- CONF
annotate(geom = "text", x = 5, y = 60000,
label = "Intervallo di confidenza 95%", hjust = 0) +
annotate(geom = "segment", x = 2.5,xend = 3,
y = 60000,yend=60000, colour="red") +
annotate(geom = "segment", x = 3.5,xend = 4,
y = 60000,yend=60000, colour="red") +
#-- Test
annotate(geom = "text", x = 5, y = 55000,
label = "Test data", hjust = 0) +
annotate(geom="rect",xmin=3, xmax=3.5, ymin=55000 , ymax=56000, color="red", fill="red") +
geom_label( aes( x=40, y=10000, label="#iorestoacasa"),                 ,
color="red",
size=5 , fontface="bold" )+
#-- #iorestoacasa
labs(title = "Crescita contagiati Coronavirus Italia ",
subtitle = "Previsione curva di crescita",
caption = "Dati: Protezione Civile \n
#iorestoacasa",
x = "Giorni",
y = "Totale Positivi")
ggplot(xy_fit,aes(x=1:50,y=Prediction))  +
geom_line() +
geom_point(colour="blue",aes(y=xy$y)) +
geom_point(colour="red",aes(y=nomodel),shape=15,size=2) +
geom_line(aes(y = Lower), color = "red", linetype = "dashed")+
geom_line(aes(y = Upper), color = "red", linetype = "dashed")+
#-- ITALY
annotate(geom = "text", x = 5, y = 70000,
label = "Training data", hjust = 0) +
annotate("pointrange", x = 3.5, y = 70000, ymin = 69500,
ymax = 70500,colour = "blue", size = 0.7)+
#-- FIT
annotate(geom = "text", x = 5, y = 65000,
label = "Fit logistico", hjust = 0) +
annotate(geom = "segment", x = 2.5,xend = 4,
y = 65000,yend=65000) +
#-- CONF
annotate(geom = "text", x = 5, y = 60000,
label = "Intervallo di confidenza 95%", hjust = 0) +
annotate(geom = "segment", x = 2.5,xend = 3,
y = 60000,yend=60000, colour="red") +
annotate(geom = "segment", x = 3.5,xend = 4,
y = 60000,yend=60000, colour="red") +
#-- Test
annotate(geom = "text", x = 5, y = 55000,
label = "Test data", hjust = 0) +
annotate(geom="rect",xmin=3, xmax=3.5, ymin=55000 , ymax=56000, color="red", fill="red") +
geom_label( aes( x=40, y=10000, label="#iorestoacasa"),                 ,
color="black",
size=5 , fontface="bold" )+
#-- #iorestoacasa
labs(title = "Crescita contagiati Coronavirus Italia ",
subtitle = "Previsione curva di crescita",
caption = "Dati: Protezione Civile \n
#iorestoacasa",
x = "Giorni",
y = "Totale Positivi")
ggplot(xy_fit,aes(x=1:50,y=Prediction))  +
geom_line() +
geom_point(colour="blue",aes(y=xy$y)) +
geom_point(colour="red",aes(y=nomodel),shape=15,size=2) +
geom_line(aes(y = Lower), color = "red", linetype = "dashed")+
geom_line(aes(y = Upper), color = "red", linetype = "dashed")+
#-- ITALY
annotate(geom = "text", x = 5, y = 70000,
label = "Training data", hjust = 0) +
annotate("pointrange", x = 3.5, y = 70000, ymin = 69500,
ymax = 70500,colour = "blue", size = 0.7)+
#-- FIT
annotate(geom = "text", x = 5, y = 65000,
label = "Fit logistico", hjust = 0) +
annotate(geom = "segment", x = 2.5,xend = 4,
y = 65000,yend=65000) +
#-- CONF
annotate(geom = "text", x = 5, y = 60000,
label = "Intervallo di confidenza 95%", hjust = 0) +
annotate(geom = "segment", x = 2.5,xend = 3,
y = 60000,yend=60000, colour="red") +
annotate(geom = "segment", x = 3.5,xend = 4,
y = 60000,yend=60000, colour="red") +
#-- Test
annotate(geom = "text", x = 5, y = 55000,
label = "Test data", hjust = 0) +
annotate(geom="rect",xmin=3, xmax=3.6, ymin=55000 , ymax=57000, color="red", fill="red") +
geom_label( aes( x=40, y=10000, label="#iorestoacasa"),                 ,
color="black",
size=5 , fontface="bold" )+
#-- #iorestoacasa
labs(title = "Crescita contagiati Coronavirus Italia ",
subtitle = "Previsione curva di crescita",
caption = "Dati: Protezione Civile \n
#iorestoacasa",
x = "Giorni",
y = "Totale Positivi")
ggplot(xy_fit,aes(x=1:50,y=Prediction))  +
geom_line() +
geom_point(colour="blue",aes(y=xy$y)) +
geom_point(colour="red",aes(y=nomodel),shape=15,size=2) +
geom_line(aes(y = Lower), color = "red", linetype = "dashed")+
geom_line(aes(y = Upper), color = "red", linetype = "dashed")+
#-- ITALY
annotate(geom = "text", x = 5, y = 70000,
label = "Training data", hjust = 0) +
annotate("pointrange", x = 3.5, y = 70000, ymin = 69500,
ymax = 70500,colour = "blue", size = 0.7)+
#-- FIT
annotate(geom = "text", x = 5, y = 65000,
label = "Fit logistico", hjust = 0) +
annotate(geom = "segment", x = 2.5,xend = 4,
y = 65000,yend=65000) +
#-- CONF
annotate(geom = "text", x = 5, y = 60000,
label = "Intervallo di confidenza 95%", hjust = 0) +
annotate(geom = "segment", x = 2.5,xend = 3,
y = 60000,yend=60000, colour="red") +
annotate(geom = "segment", x = 3.5,xend = 4,
y = 60000,yend=60000, colour="red") +
#-- Test
annotate(geom = "text", x = 5, y = 55000,
label = "Test data", hjust = 0) +
annotate(geom="rect",xmin=3, xmax=3.6, ymin=54000 , ymax=56000, color="red", fill="red") +
geom_label( aes( x=40, y=10000, label="#iorestoacasa"),                 ,
color="black",
size=5 , fontface="bold" )+
#-- #iorestoacasa
labs(title = "Crescita contagiati Coronavirus Italia ",
subtitle = "Previsione curva di crescita",
caption = "Dati: Protezione Civile \n
#iorestoacasa",
x = "Giorni",
y = "Totale Positivi")
covid_italy_sum$totale_casi
xy_fit$Prediction
covid_italy_sum$data
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
library(dplyr)
library(drc)
library(lubridate)
library(ggplot2)
theme_set(theme_bw())
# get the data
covid_italy_sum <- read.csv("https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-andamento-nazionale/dpc-covid19-ita-andamento-nazionale.csv")
x <-  1:50
nn <- 3
cov_tot <-  rep(NA,50)
gg <-  length(covid_italy_sum$totale_casi)
cov_tot[1:(gg-nn)]    <- covid_italy_sum$totale_casi[1:(gg-nn)]
xy <- data.frame(x=x,y=cov_tot)
# fitting logistico
model <- drm(y ~ x, fct = L.3(), data = xy[1:(gg-nn),])
# prediction
xy_fit <-
predict(model,xy,interval = 'confidence')  %>%
as.data.frame()
# plot fitting
nomodel <- rep(NA,50)
nomodel[(gg-nn+1):gg] <- covid_italy_sum$totale_casi[(gg-nn+1):gg]
ggplot(xy_fit,aes(x=1:50,y=Prediction))  +
geom_line() +
geom_point(colour="blue",aes(y=xy$y)) +
geom_point(colour="red",aes(y=nomodel),shape=15,size=2) +
geom_line(aes(y = Lower), color = "red", linetype = "dashed")+
geom_line(aes(y = Upper), color = "red", linetype = "dashed")+
#-- ITALY
annotate(geom = "text", x = 5, y = 70000,
label = "Training data", hjust = 0) +
annotate("pointrange", x = 3.5, y = 70000, ymin = 69500,
ymax = 70500,colour = "blue", size = 0.7)+
#-- FIT
annotate(geom = "text", x = 5, y = 65000,
label = "Fit logistico", hjust = 0) +
annotate(geom = "segment", x = 2.5,xend = 4,
y = 65000,yend=65000) +
#-- CONF
annotate(geom = "text", x = 5, y = 60000,
label = "Intervallo di confidenza 95%", hjust = 0) +
annotate(geom = "segment", x = 2.5,xend = 3,
y = 60000,yend=60000, colour="red") +
annotate(geom = "segment", x = 3.5,xend = 4,
y = 60000,yend=60000, colour="red") +
#-- Test
annotate(geom = "text", x = 5, y = 55000,
label = "Test data", hjust = 0) +
annotate(geom="rect",xmin=3, xmax=3.6, ymin=54000 , ymax=56000, color="red", fill="red") +
geom_label( aes( x=40, y=10000, label="#iorestoacasa"),                 ,
color="black",
size=5 , fontface="bold" )+
#-- #iorestoacasa
labs(title = "Crescita contagiati Coronavirus Italia ",
subtitle = "Previsione curva di crescita",
caption = "Dati: Protezione Civile",
x = "Giorni",
y = "Totale Positivi")
covid_italy_sum$totale_casi
xy_fit[25]
xy_fit[25,]
source('~/R-TRAINER/R-GIT/covid19_italy/chinaVsitaly.R')
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
library(dplyr)
library(drc)
library(lubridate)
library(ggplot2)
theme_set(theme_bw())
# get the data
covid_italy_sum <- read.csv("https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-andamento-nazionale/dpc-covid19-ita-andamento-nazionale.csv")
x <-  1:50
nn <- 0
cov_tot <-  rep(NA,50)
gg <-  length(covid_italy_sum$totale_casi)
cov_tot[1:(gg-nn)]    <- covid_italy_sum$totale_casi[1:(gg-nn)]
xy <- data.frame(x=x,y=cov_tot)
# fitting logistico
model <- drm(y ~ x, fct = L.3(), data = xy[1:(gg-nn),])
# prediction
xy_fit <-
predict(model,xy,interval = 'confidence')  %>%
as.data.frame()
# plot fitting
nomodel <- rep(NA,50)
nomodel[(gg-nn+1):gg] <- covid_italy_sum$totale_casi[(gg-nn+1):gg]
ggplot(xy_fit,aes(x=1:50,y=Prediction))  +
geom_line() +
geom_point(colour="blue",aes(y=xy$y)) +
geom_point(colour="red",aes(y=nomodel),shape=15,size=2) +
geom_line(aes(y = Lower), color = "red", linetype = "dashed")+
geom_line(aes(y = Upper), color = "red", linetype = "dashed")+
#-- ITALY
annotate(geom = "text", x = 5, y = 70000,
label = "Training data", hjust = 0) +
annotate("pointrange", x = 3.5, y = 70000, ymin = 69500,
ymax = 70500,colour = "blue", size = 0.7)+
#-- FIT
annotate(geom = "text", x = 5, y = 65000,
label = "Fit logistico", hjust = 0) +
annotate(geom = "segment", x = 2.5,xend = 4,
y = 65000,yend=65000) +
#-- CONF
annotate(geom = "text", x = 5, y = 60000,
label = "Intervallo di confidenza 95%", hjust = 0) +
annotate(geom = "segment", x = 2.5,xend = 3,
y = 60000,yend=60000, colour="red") +
annotate(geom = "segment", x = 3.5,xend = 4,
y = 60000,yend=60000, colour="red") +
#-- Test
annotate(geom = "text", x = 5, y = 55000,
label = "Test data", hjust = 0) +
annotate(geom="rect",xmin=3, xmax=3.6, ymin=54000 , ymax=56000, color="red", fill="red") +
geom_label( aes( x=40, y=10000, label="#iorestoacasa"),                 ,
color="black",
size=5 , fontface="bold" )+
#-- #iorestoacasa
labs(title = "Crescita contagiati Coronavirus Italia ",
subtitle = "Previsione curva di crescita",
caption = "Dati: Protezione Civile",
x = "Giorni",
y = "Totale Positivi")
model
summary(model)
nomodel
1:(gg-nn)
gg
nn
x <-  1:50
nn <- 0   # test
cov_tot <-  rep(NA,50)
gg <-  length(covid_italy_sum$totale_casi)
cov_tot[1:(gg-nn)]    <- covid_italy_sum$totale_casi[1:(gg-nn)]
xy <- data.frame(x=x,y=cov_tot)
# fitting logistico
model <- drm(y ~ x, fct = L.3(), data = xy[1:(gg-nn),])
# prediction
xy_fit <-
predict(model,xy,interval = 'confidence')  %>%
as.data.frame()
# plot fitting
nomodel <- rep(NA,50)
nomodel[(gg-nn+1):gg] <- covid_italy_sum$totale_casi[(gg-nn+1):gg]
nomodel
nomodel[(gg-nn):gg] <- covid_italy_sum$totale_casi[(gg-nn):gg]
nomodel
# plot fitting
nomodel <- rep(NA,50)
nomodel[(gg-nn+1):gg] <- covid_italy_sum$totale_casi[(gg-nn+1):gg]
ggplot(xy_fit,aes(x=1:50,y=Prediction))  +
geom_line() +
geom_point(colour="blue",aes(y=xy$y)) +
#  geom_point(colour="red",aes(y=nomodel),shape=15,size=2) +
geom_line(aes(y = Lower), color = "red", linetype = "dashed")+
geom_line(aes(y = Upper), color = "red", linetype = "dashed")+
#-- ITALY
annotate(geom = "text", x = 5, y = 70000,
label = "Training data", hjust = 0) +
annotate("pointrange", x = 3.5, y = 70000, ymin = 69500,
ymax = 70500,colour = "blue", size = 0.7)+
#-- FIT
annotate(geom = "text", x = 5, y = 65000,
label = "Fit logistico", hjust = 0) +
annotate(geom = "segment", x = 2.5,xend = 4,
y = 65000,yend=65000) +
#-- CONF
annotate(geom = "text", x = 5, y = 60000,
label = "Intervallo di confidenza 95%", hjust = 0) +
annotate(geom = "segment", x = 2.5,xend = 3,
y = 60000,yend=60000, colour="red") +
annotate(geom = "segment", x = 3.5,xend = 4,
y = 60000,yend=60000, colour="red") +
#-- Test
annotate(geom = "text", x = 5, y = 55000,
label = "Test data", hjust = 0) +
annotate(geom="rect",xmin=3, xmax=3.6, ymin=54000 , ymax=56000, color="red", fill="red") +
geom_label( aes( x=40, y=10000, label="#iorestoacasa"),                 ,
color="black",
size=5 , fontface="bold" )+
#-- #iorestoacasa
labs(title = "Crescita contagiati Coronavirus Italia ",
subtitle = "Previsione curva di crescita",
caption = "Dati: Protezione Civile",
x = "Giorni",
y = "Totale Positivi")
x <-  1:60
nn <- 0   # test
cov_tot <-  rep(NA,60)
gg <-  length(covid_italy_sum$totale_casi)
cov_tot[1:(gg-nn)]    <- covid_italy_sum$totale_casi[1:(gg-nn)]
xy <- data.frame(x=x,y=cov_tot)
# fitting logistico
model <- drm(y ~ x, fct = L.3(), data = xy[1:(gg-nn),])
# prediction
xy_fit <-
predict(model,xy,interval = 'confidence')  %>%
as.data.frame()
covid_italy_sum <- read.csv("https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-andamento-nazionale/dpc-covid19-ita-andamento-nazionale.csv")
y <-
coronavirus %>%
filter(Country.Region == "Mainland China") %>%
filter(type =="confirmed") %>%
group_by(date,type) %>%
summarise(cases = sum(cases)) %>%
group_by(type) %>%
mutate(cases_tot = cumsum(cases)) %>%
pull(cases_tot)
y
data("coronavirus")
devtools::install_github("RamiKrispin/coronavirus")
devtools::install_github("RamiKrispin/coronavirus")
install.packages("processx")
devtools::install_github("RamiKrispin/coronavirus")
devtools::install_github("RamiKrispin/coronavirus")
install.packages("rlang")
install.packages("rlang")
devtools::install_github("RamiKrispin/coronavirus")
install.packages("glue")
install.packages("glue")
devtools::install_github("RamiKrispin/coronavirus")
devtools::install_github("RamiKrispin/coronavirus")
library(coronavirus)
data("coronavirus")
y <-
coronavirus %>%
filter(Country.Region == "Mainland China") %>%
filter(type =="confirmed") %>%
group_by(date,type) %>%
summarise(cases = sum(cases)) %>%
group_by(type) %>%
mutate(cases_tot = cumsum(cases)) %>%
pull(cases_tot)
library(ggplot2)
library(coronavirus)
library(dplyr)
theme_set(theme_bw())
library(drc)
covid_italy_sum <- read.csv("https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-andamento-nazionale/dpc-covid19-ita-andamento-nazionale.csv")
data("coronavirus")
y <-
coronavirus %>%
filter(Country.Region == "Mainland China") %>%
filter(type =="confirmed") %>%
group_by(date,type) %>%
summarise(cases = sum(cases)) %>%
group_by(type) %>%
mutate(cases_tot = cumsum(cases)) %>%
pull(cases_tot)
x <- 0:(length(y)-1)
#-----------------
xy <- data.frame(x=x,y=y)
